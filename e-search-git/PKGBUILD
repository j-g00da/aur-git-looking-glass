# Generated by debtap
# Maintainer: e-search-git
# Contributor: e-search-git
pkgname=e-search-git
pkgver=1.9.0
pkgrel=1
pkgdesc="识屏 · 搜索"
arch=('x86_64')
url="https://github.com/xushengfeng/eSearch"
license=('GPL3')
groups=('')
depends=('at-spi2-core' 'clion' 'desktop-file-utils' 'glib2' 'gtk3' 'hicolor-icon-theme' 'kde-cli-tools' 'libdrm' 'libnotify' 'libxcb' 'libxtst' 'mesa' 'metasploit' 'trash-cli' 'xdg-utils' 'libappindicator-gtk3')
makedepends=('git' 'npm' 'nodejs' 'node-gyp' 'python')
optdepends=('alsa-lib'
            'apparmor'
            'gir1.2-gnomekeyring-1.0'
            'libgnome-keyring'
            'pulseaudio')
conflicts=('e-search')
options=('!strip' '!emptydirs')
install=${pkgname}.install
source=("git+https://github.com/xushengfeng/eSearch")
sha512sums=('SKIP')


prepare() {
    cd "${srcdir}/eSearch"
    git checkout $(git describe --abbrev=0 --tags)
    npm install
}


build() {
    cd "${srcdir}/eSearch"
    sed -i "s/\"tar.gz\",//g" package.json
    sed -i "s/\"deb\",/\"deb\"/g" package.json
    sed -i "s/\"rpm\",//g" package.json
    sed -i "s/\"AppImage\"//g" package.json
    npm run dist
}

package(){
    cd "${srcdir}/eSearch/build"

	# Extract package data
    ar -x *.deb
	tar xf data.tar.xz -C "${pkgdir}"

	install -D -m644 "${pkgdir}/opt/eSearch/LICENSES.chromium.html" "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"

}
