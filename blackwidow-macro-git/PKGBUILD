# Maintainer: mgabor3141 <9047995+mgabor3141@users.noreply.github.com>

pkgname=blackwidow-macro-git
pkgver=0.r45.g6954d10   # auto-generated by pkgver()
pkgrel=1
pkgdesc="Enable macro keys on Razer BlackWidow keyboards (udev helper)"
arch=('x86_64')  # add if you test on other arches
url="https://github.com/equk/blackwidow_macro"
license=('MIT')
depends=('glibc'
         'libusb')
makedepends=('git')
provides=('blackwidow_macro')
conflicts=('blackwidow_macro')
source=("git+$url.git")
sha256sums=('SKIP')

pkgver() {
  cd "$srcdir/blackwidow_macro"
  # r<commitcount>.g<shortsha> style
  printf "0.r%s.g%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

prepare() {
  cd "$srcdir/blackwidow_macro"
}

build() {
  cd "$srcdir/blackwidow_macro"
  make
}

package() {
  cd "$srcdir/blackwidow_macro"

  # The Makefile has install targets, but we install explicitly to control paths
  install -Dm755 "bin/bwidow" "$pkgdir/usr/bin/bwidow"

  # Ship the udev rule so keys initialize on plug-in/boot
  install -Dm644 "udev/99-bwidow.rules" \
    "$pkgdir/usr/lib/udev/rules.d/99-bwidow.rules"

  # License
  install -Dm644 "LICENSE" "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
}
