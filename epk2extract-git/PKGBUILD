# Maintainer: Hajos Attila <linux[dot]alucard[at]gmail[dot]com>
# Contributor: Tim Schumacher <timschumi@gmx.de>

pkgname=epk2extract-git
pkgver=r709
pkgrel=1
pkgdesc="Extraction tool for LG, Hisense, Sharp, Philips/TPV, Thompson and similar TVs/Embedded Devices."
url='https://github.com/openlgtv/epk2extract'
license=(GPL2)
arch=($CARCH)
depends=()
makedepends=(cmake)
source=("git+https://github.com/openlgtv/epk2extract")
sha256sums=('SKIP')

pkgver() {
  cd "${srcdir}/epk2extract"
  printf "r%d" "$(git rev-list --count HEAD)"
}

build() {
  cd "${srcdir}/epk2extract"

  # As recommended by the README for non-Debug builds
  CMAKE_FLAGS=-DCMAKE_BUILD_TYPE=Test ./build.sh
}

package() {
  mkdir -p "${pkgdir}/opt"
  cp -r "${srcdir}/epk2extract/build_linux" "${pkgdir}/opt/epk2extract"
  mkdir -p "${pkgdir}/usr/bin"
  ln -s "/opt/epk2extract/epk2extract" "${pkgdir}/usr/bin/epk2extract"
  
  # Remove files generated by cmake
  rm -rf "${pkgdir}/opt/epk2extract/obj/"
}
