# This file was generated by GoReleaser. DO NOT EDIT.
# Maintainer: Fernandez Ludovic <lfernandez dot dev at gmail dot com>
# Maintainer: Carlos Alexandro Becker <carlos at becker dot software>

pkgname='nfpm'
pkgver=2.44.0
pkgrel=1
pkgdesc='nFPM is a simple, 0-dependencies, deb, rpm and apk packager.'
url='https://nfpm.goreleaser.com'
arch=('aarch64' 'x86_64')
license=('MIT')
provides=('nfpm')
conflicts=('nfpm')
makedepends=('go' 'git')
source=("${pkgname}_${pkgver}.tar.gz::https://github.com/goreleaser/nfpm/releases/download/v${pkgver}/nfpm_${pkgver}_source.tar.gz")
sha256sums=('597b38d12d493e1e7b0ba1970c2eed74a6e2dff88239340ccf1645b96d6d1e8f')
build() {
  export CGO_CPPFLAGS="${CPPFLAGS}"
  export CGO_CFLAGS="${CFLAGS}"
  export CGO_CXXFLAGS="${CXXFLAGS}"
  export CGO_LDFLAGS="${LDFLAGS}"
  export GOFLAGS="-buildmode=pie -trimpath -mod=readonly -modcacherw"
  go build -ldflags="-w -s -buildid='' -linkmode=external -X main.version=v${pkgver}" ./cmd/nfpm

  chmod +x "./${pkgname}"
}
package() {
  # Bin
  install -Dsm755 "./${pkgname}" "${pkgdir}/usr/bin/${pkgname}"

  # License
  install -Dm644 "./LICENSE.md" "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"

  # Completions
  mkdir -p "${pkgdir}/usr/share/bash-completion/completions/"
  mkdir -p "${pkgdir}/usr/share/zsh/site-functions/"
  mkdir -p "${pkgdir}/usr/share/fish/vendor_completions.d/"
  ./${pkgname} completion bash > "${pkgdir}/usr/share/bash-completion/completions/${pkgname}"
  ./${pkgname} completion zsh > "${pkgdir}/usr/share/zsh/site-functions/_${pkgname}"
  ./${pkgname} completion fish > "${pkgdir}/usr/share/fish/vendor_completions.d/${pkgname}.fish"
}
