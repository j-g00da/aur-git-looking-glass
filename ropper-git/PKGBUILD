# Maintainer:
# Contributor: Levente Polyak <anthraxx[at]archlinux[dot]org>

pkgname='ropper-git'
pkgver=1.13.10.r0.ga1141ab
pkgrel=1
pkgdesc='Show information about binary files and find gadgets to build rop chains for different architectures'
url='https://github.com/sashs/Ropper'
arch=('any')
license=('BSD-3-Clause')
depends=(
  python
  python-capstone
  python-filebytes
  python-z3-solver
  python-pyvex
  python-archinfo
)
makedepends=(
  git
  python-build
  python-installer
  python-wheel
  python-setuptools
)
checkdepends=(
  python-pytest
)
provides=('ropper' 'python-ropper')
conflicts=('ropper')
source=("${pkgname}::git+${url}.git")
sha512sums=('SKIP')

pkgver() {
  cd ${pkgname}
  git describe --long --tags | sed 's/^v//;s/-/.r/;s/-/./g'
}

build() {
  cd ${pkgname}
  python -m build --wheel --no-isolation
}

check() {
  cd ${pkgname}
  pytest
}

package() {
  cd ${pkgname}
  python -m installer --destdir="$pkgdir" dist/*.whl
  install -Dm 644 README.md sample.py -t "${pkgdir}/usr/share/doc/${pkgname}/README.md"
  install -Dm 644 COPYING -t "${pkgdir}/usr/share/licenses/${pkgname}"
}

# vim: ts=2 sw=2 et:
