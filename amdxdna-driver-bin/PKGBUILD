# Generated by debtap
# Maintainer: Kainoa Kanter <kainoa@t1c.dev>

_pkgname=amdxdna-driver
pkgname="${_pkgname}-bin"
pkgver=2.19.0
pkgrel=5
pkgdesc="AMD XDNA(tm) Driver (amdxdna.ko) for Linux and XRT SHIM library development."
arch=('x86_64')
url="https://github.com/amd/xdna-driver/"
license=('custom')
depends=('dkms')
makedepends=('bash')
optdepends=('xrt-npu-git: to make it work, maybe?')
install="xrt_plugin-amdxdna.install"
provides=("${_pkgname}")
conflicts=("${_pkgname}")
source=(
	"https://github.com/ThatOneCalculator/xdna-driver/releases/download/${pkgver}/xrt_plugin.${pkgver}_endeavouros-x86_64-amdxdna.deb"
	"xrt_plugin-amdxdna.install"
)
sha512sums=('b7e8df5a3c09f56fe0a285747dfd16b26711bcc098bcc830380a7a42f92df1712bf979b22b29d7930cdc94dac91b65732959442d064c3b9d85048e0e355783ed'
            'c447475834dca92234c90ebb3f5e07b5cd28af3d81811c32d976378d63dbd07add00e5a231d33230929abd361b0c5036e8b2137a62b4f177ed4af2a662d608c3')

package(){

	# Extract package data
	tar -xz -f data.tar.gz -C "${pkgdir}"

	# Fix directory structure differences
	cd "${pkgdir}"

	mkdir -p usr/lib 2> /dev/null; mv lib/* usr/lib; rm -rf lib

	install -Dm644 "opt/xilinx/xrt/amdxdna/dkms.conf" "${pkgdir}/usr/src/${_pkgname}-${pkgver}/dkms.conf"

	cd ..

}
