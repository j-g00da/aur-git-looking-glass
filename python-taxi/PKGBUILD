# Maintainer: Simon Brulhart <simon@brulhart.me>

pkgname=python-taxi
_name=taxi
pkgver=6.3.1
pkgrel=3
pkgdesc="Timesheeting tool that focuses on simplicity"
arch=('any')
license=('custom')
url="https://github.com/sephii/taxi"
depends=(python-appdirs python-click)
makedepends=(python-build python-flit-core python-installer python-wheel)
optdepends=("python-taxi-zebra: Zebra backend for Taxi")
source=(
    "$pkgname-$pkgver.tar.gz::https://github.com/sephii/taxi/archive/$pkgver.tar.gz"
    taxi-complete.bash
    taxi-complete.zsh
)
sha512sums=('fb1ab86d06b3272f9cdec3f22298b0b5353e6efd489f6941da88b5f28c8584f6b91c9280d2ab6fdda0a063fb5e1f444b33f0947830ebd8fbcb879ca143316254'
            '006e058e78737f3e9da2da7a31e66b5b6b220c3a4c952cc911de8d093a13cb3df63cbf9a12fc4fb9a1b6a59031f5d44396871f49333956e24b9c58a487872152'
            '3bbb8f968dc1a6fabcc0b974441c59e09255b98706713b9c3737f985ca807ab41992885455e4afdfc8556e244f0abf6ebfb2dcd0ffbd657ed95100d85c9fba2b')

build() {
    cd $_name-$pkgver
    python -m build --wheel --no-isolation
}

package() {
    cd $_name-$pkgver
    python -m installer --destdir="$pkgdir" dist/*.whl

    install -Dm644 LICENSE "$pkgdir"/usr/share/licenses/$pkgname/LICENSE

    cd "$srcdir"
    # Completion file is generated by running `_TAXI_COMPLETE=bash_source taxi > taxi-complete.bash`
    install -Dm644 taxi-complete.bash "$pkgdir"/usr/share/bash-completion/completions/taxi
    # Completion file is generated by running `_TAXI_COMPLETE=zsh_source taxi > taxi-complete.zsh`
    # and adding `#compdef taxi` on the first line
    install -Dm644 taxi-complete.zsh "$pkgdir"/usr/share/zsh/site-functions/_taxi
}
