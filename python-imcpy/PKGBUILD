# Maintainer: Oystein Sture <oysstu a.t protonmail.com>
# Contributor: 

pkgname=python-imcpy
pkgver=1.1.2
pkgrel=1
pkgdesc="Python bindings for Inter-Module Communication Protocol (IMC)"
arch=("any")
license=("MIT")
url="https://github.com/oysstu/imcpy"
depends=('python' 'python-ifaddr')
makedepends=('git' 'python-build' 'python-installer' 'python-wheel' 'python-setuptools' 'cmake')
optdepends=('python-pandas: LSFExporter')
source=("git+https://github.com/oysstu/imcpy.git#tag=v${pkgver}")
sha256sums=('SKIP')

prepare() {
    cd "$srcdir/imcpy"
    
    # Remove previous wheels and autogenerated files
    rm -rf dist
    (cd dune && git checkout .)

    # Ensure submodules are up-to-date
    git submodule update --init --recursive
}

build() {
    cd "$srcdir/imcpy"
    python -m build --wheel --no-isolation --skip-dependency-check
}

package() {
    cd "$srcdir/imcpy/dist"
    python -m installer --destdir="$pkgdir" $(find ~+ -name "*.whl" -print -quit)
}
